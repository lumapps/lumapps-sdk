version: 2.1
executors:
  python:
    parameters:
      version:
        type: string
        default: lastest
    docker:
      - image: python:<< parameters.version >>

jobs:
  build:
    parameters:
      version:
        type: string
    executor:
      name: python
      version: << parameters.version >>
    working_directory: ~/lumapps-sdk
    steps:
      - checkout
      - run: sudo chown -R circleci:circleci /usr/local/bin
      - run: sudo chown -R circleci:circleci /usr/local/lib/python<< parameters.version >>
      - restore_cache:
          key: python<< parameters.version >>-requirements-{{ checksum "requirements.txt" }}
      - run: pip install -e .
      - run: python --version
      - save_cache:
          key: python<< parameters.version >>-requirements-{{ checksum "requirements.txt" }}
          paths:
            - "~/.cache/pip"
            - "/usr/local/lib/python<< parameters.version >>/site-packges"
            - "/usr/local/lib/site-python"


workflows:
  version: 2.1
  
  workflow:
    jobs:
      - build:
          version: "2.7"


